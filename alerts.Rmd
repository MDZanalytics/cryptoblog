---
title: "MA and EMA cross alerts"
author: "Mark Ziemann"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
theme: cosmo
---

## Intro

Previously I showed that the 43 day moving average was amongst the simplest and most profitable trading signals for Bitcoin.
For ETH, the 34 day is preferred.
This is a script designed to send a trade alert for buy and sell signals.

```{r,lib}

library("jsonlite")
library("tidyverse")
library("runner")
library("quantmod")
library("TTR")
library("RPushbullet")

TESTING = TRUE

```

## Get BTC data

Obtaining BTC historical data (daily).

```{r,btc1}

datebefore <- Sys.Date()-100
mydate <- Sys.Date()-1
URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=BTC&convert=USD&interval=daily&time_start=",datebefore,"&time_end=",mydate,sep="")
download.file(URL,destfile="btcdat.txt")
btcdat <- fromJSON("btcdat.txt")
price <- btcdat$data$quotes
price <- data.frame(price$time_close,price$quote$USD$close)
colnames(price) <- c("date","Close")
price$date <- sapply(strsplit(as.character(price$date),"T"),"[[",1)

if ( TESTING == TRUE) {
  price[nrow(price),"Close"] <- price[nrow(price),"Close"] * 2
}

```

## BTC on the 43 MA

```{r, btc_sma}

price$ma <- SMA(Cl(price),n=43)
price$signal <- price$Close > price$ma
tail(price)
today_signal <- price[nrow(price),"signal"]
previous_signal <- price[(nrow(price)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    btc_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) { 
    btc_signal="SELL"
  }
} else {
btc_signal <- "NONE"
}
btc_signal

plot(price$Close~as.Date(price$date),type="l",
  xlab="Date",ylab="price (USD)",main="BTC w 43D MA")
grid()
lines(price$ma~ as.Date(price$date) ,col="red")

```

Send a push notification.

```{r,btcpush}

if ( btc_signal != "NONE") {
  MYNOTE <- paste("The BTC 43D MA signal is", btc_signal, 
    ". Visit https://blinder.cc/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## Get ETH data

Obtaining ETH historical data (daily).

```{r,eth1}

datebefore <- Sys.Date()-100
mydate <- Sys.Date()-1
URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=ETH&convert=USD&interval=daily&time_start=",datebefore,"&time_end=",mydate,sep="")
download.file(URL,destfile="ethdat.txt")
ethdat <- fromJSON("ethdat.txt")
price <- ethdat$data$quotes
price <- data.frame(price$time_close,price$quote$USD$close)
colnames(price) <- c("date","Close")
price$date <- sapply(strsplit(as.character(price$date),"T"),"[[",1)

if ( TESTING == TRUE) {
  price[nrow(price),"Close"] <- price[nrow(price),"Close"] * 2
}

```

## ETH on the 34 MA

```{r, eth_sma}

price$ma <- SMA(Cl(price),n=34)
price$signal <- price$Close > price$ma
tail(price)
today_signal <- price[nrow(price),"signal"]
previous_signal <- price[(nrow(price)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    eth_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    eth_signal="SELL"
  }
} else {
  eth_signal <- "NONE"
}

eth_signal

plot(price$Close~as.Date(price$date),type="l",
  xlab="Date",ylab="price (USD)",main="ETH w 34D MA")
grid()
lines(price$ma~ as.Date(price$date) ,col="red")

```

Send a push notification.

```{r,ethpush}

if ( eth_signal != "NONE") {
  MYNOTE <- paste("The ETH 34D MA signal is", eth_signal,
   ". Visit https://blinder.cc/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## Session information

For reproducibility

```{r,sessioninfo}

sessionInfo()

```
