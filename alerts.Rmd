---
title: "Daily trade alerts for BTC and ETH"
author: "Mark Ziemann https://mdz-analytics.com"
date: "`r Sys.Date()+1`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    fig_width: 7
    fig_height: 7
theme: cosmo
---

Source: https://github.com/markziemann/cryptoblog/blob/main/alerts.Rmd

## Intro

In the backtesting analysis, I have established three different strategies for timing entry/exits.
Click on the hyperlinks below to see how these signals were identified.

1. Simple moving averages: <a href="https://mdz-analytics.com/crypto/ma_trading.html">BTC</a> 43 day; 
<a href="https://mdz-analytics.com/crypto/ma_trading_eth.html">ETH</a> 34 day.

2. Moving average crosses: <a href="https://mdz-analytics.com/crypto/ma_cross.html">BTC</a> 12/21 day SMA and;
<a href="https://mdz-analytics.com/crypto/ma_cross_eth.html">ETH</a> 5/27 day.

3. Directional movement index (DMI): <a href="https://mdz-analytics.com/crypto/dmi_trading.html">BTC</a> 26 day;
<a href="https://mdz-analytics.com/crypto/dmi_trading_eth.html">ETH</a> 19 day.

4. True strength index (TSI): <a href="https://mdz-analytics.com/crypto/tsi_trading.html">BTC</a> n1=99, n2=15, n.signal=5;
<a href="https://mdz-analytics.com/crypto/tsi_trading.html">ETH</a> n1=99, n2=3, n.signal=13.

This script will examine the price action just before the daily close and then investigate whether these trading signals are flashing.
Note that alerts for TSI are not ready yet.
Alerts will be sent by pushbullet.

If you would like to receive these signals in real-time, you can subscribe for 0.0005 BTC per year.
If you need some help to design your own trading signals, I am happy to help for a fee.
email me at mark.ziemann{Î±t}gmail.com for any enquiries.

If you find this resource useful, consider a small tip.

BTC: 3PCBnq7TH37t6uQmVePjpHaHvzFFh72ZbM

LTC: MLzwpLhHE81xB459H15sDN7kBW16kLgHCF

Reminder: this analysis is not financial advice.

```{r,lib}

suppressPackageStartupMessages({
  library("jsonlite")
  library("tidyverse")
  library("runner")
  library("quantmod")
  library("TTR")
  library("RPushbullet")
  library("kableExtra")
})

TESTING = FALSE

```

## Get BTC price data

Obtaining BTC price data (daily) for the last 300 days.

```{r,btc_data1}

datebefore <- Sys.Date()-300
mydate <- Sys.Date()
URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=BTC&convert=USD&interval=daily&time_start=",datebefore,"&time_end=",Sys.Date(),sep="")
download.file(URL,destfile="btcdat.txt")
btcdat <- fromJSON("btcdat.txt")
price <- btcdat$data$quotes
price <- data.frame(  as.Date(price$time_close) , price$quote$USD$high, price$quote$USD$low, price$quote$USD$close)
colnames(price) <- c("date","high","low","close")
tail(price) %>% kbl() %>%  kable_paper("hover", full_width = F)

```

Now gather houly price data for the last 23 hours.

```{r,btc_data2}

URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=BTC&convert=USD&interval=hourly&time_period=hourly&time_start=",Sys.Date(),"&time_end=",Sys.Date()+1,sep="")
download.file(URL,destfile="btcdat.txt")
btcdat <- fromJSON("btcdat.txt")
price2 <- btcdat$data$quotes
price2 <- data.frame( as.Date(price2$time_close) , price2$quote$USD$high, price2$quote$USD$low, price2$quote$USD$close,stringsAsFactors=FALSE)
colnames(price2) <- c("date","high","low","close")
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

high <- max(price2[,2])
low <-  min(price2[,3])
close <- price2[nrow(price2),4]

df <- data.frame(date=Sys.Date(),high=high,low=low,close=close,stringsAsFactors=FALSE)
price <- rbind(price,df)
tail(price) %>% kbl() %>%  kable_paper("hover", full_width = F)

if ( TESTING == TRUE) {
  price[nrow(price),"Close"] <- price[nrow(price),"Close"] * 2
}

```

## BTC SMA indicator

Now to determine whether BTC has crossed the 43-day SMA.

```{r, btc_sma}

price2 <- price

price2$ma <- SMA(Cl(price2),n=43)
price2$signal <- price2$close > price2$ma
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)
today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    btc_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) { 
    btc_signal="SELL"
  }
} else {
btc_signal <- "NONE"
}

message(paste("BTC SMA signal:",btc_signal))

```

```{r, btc_sma_plot,fig.height=8,fig.width=8}

plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="BTC w 43D MA")
grid()
lines(price2$ma~ as.Date(price2$date) ,col="red")

```

Send a push notification.

```{r,btc_sma_push}

if ( btc_signal != "NONE") {
  MYNOTE <- paste("The BTC 43D MA signal is", btc_signal, 
    ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## BTC SMA cross indicator

The 12/21 day SMA cross is a highly profitable strategy.

```{r, btc_cross}

price2 <- price

price2$ma1 <- SMA(Cl(price2),n=21)
price2$ma2 <- SMA(Cl(price2),n=12)

price2$signal <- price2$ma2 > price2$ma1
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)
today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    btc_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    btc_signal="SELL"
  }
} else {
btc_signal <- "NONE"
}

message(paste("BTC SMA cross signal:",btc_signal))

```

```{r, btc_cross_plot,fig.height=8,fig.width=8}

plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="BTC w 12/21 day SMA cross")
grid()
lines(price2$ma1~ as.Date(price2$date) ,col="red")
lines(price2$ma2~ as.Date(price2$date) ,col="blue")

```

Send a push notification.

```{r,btc_cross_push}

if ( btc_signal != "NONE") {
  MYNOTE <- paste("The BTC 12/21 day SMA cross signal is", btc_signal,
    ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## BTC DMI indicator

Directional movement indicator is a highly profitable approach to identify trend changes.
DMI using a 26 day interval gives returns 4x better than the 43D SMA approach.

```{r,btc_dmi,fig.height=10,fig.width=8}

dmi.adx <- ADX(price[,c("high","low","close")],n=26)
price2 <- cbind(price,dmi.adx)
price2$signal <- dmi.adx[,1] > dmi.adx[,2]
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    btc_signal="DMI BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    btc_signal="DMI SELL"
  }
} else {
  btc_signal <- "NONE"
}

message(paste("BTC DMI signal:",btc_signal))

```

```{r,btc_dmi_plot,fig.height=10,fig.width=8}

price2 <- as.data.frame(price2)
par(mfrow=c(2,1))
plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="BTC USD price")
grid()
plot(price2$DIp~as.Date(price2$date),type="l", col="blue",
  xlab="Date",ylab="price (USD)",main="BTC 26d DMI")
grid()
lines(price2$DIn ~ as.Date(price2$date) ,col="red")

```

Send a push notification.

```{r,btc_dmi_push}

if ( btc_signal != "NONE") {
  MYNOTE <- paste("BTC is flashing a ", btc_signal,
   ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## BTC TSI indicator

Optimised values:

n1=99, n2=14, n.sig=5

```{r,btc_tsi,fig.height=10,fig.width=8}

TSI <- function(x, n.first = 25, n.second = 13, n.signal = 7) {
  #True Strength Indicator
  #https://school.stockcharts.com/doku.php?id=technical_indicators:true_strength_index
  x <- try.xts(x, error = as.matrix)
  pc <- x - lag.xts(x, na.pad = T) #force lag.xts to get na padding
  dspc <- EMA(EMA(pc, n = n.first), n = n.second)
  dsapc <- EMA(EMA(abs(pc), n = n.first), n = n.second)

  tsi <- 100 * (dspc/dsapc)
  signal <- EMA(tsi, n = n.signal)
  r <- cbind(tsi, signal)
  r <- reclass(r, x)
  if (!is.null(dim(r))) colnames(r) <- c("tsi", "signal")
  return(r)
}

tsi <- TSI(price$close , n.first = 99, n.second = 14, n.signal = 5 )
colnames(tsi) <- c("tsi","sig")

price2 <- cbind(price,tsi)
price2$signal <- tsi[,1] > tsi[,2]
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    btc_signal="TSI BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    btc_signal="TSI SELL"
  }
} else {
  btc_signal <- "NONE"
}

message(paste("BTC TSI signal:",btc_signal))

```

```{r,btc_tsi_plot,fig.height=10,fig.width=8}

par(mfrow=c(2,1))
plot(price2$close ~ as.Date(price2$date),type="l",log="y",
  xlab="Date",ylab="price (USD)",main="USD price")
grid()

plot(tsi[,1] ~ as.Date(price2$date),type="l",col="blue",
  xlab="Date",ylab="TSI",main="TSI")
lines(as.Date(price2$date), tsi[,2]  , col="red"  )
grid()

par(mfrow=c(1,1))

```

Send a push notification.

```{r,btc_tsi_push}

if ( btc_signal != "NONE") {
  MYNOTE <- paste("BTC is flashing a ", btc_signal,
   ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## Get ETH price data

Obtaining ETH historical data (daily).

```{r,eth1}

datebefore <- Sys.Date()-300
mydate <- Sys.Date()
URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=ETH&convert=USD&interval=daily&time_start=",datebefore,"&time_end=",Sys.Date(),sep="")
download.file(URL,destfile="ethdat.txt")
ethdat <- fromJSON("ethdat.txt")
price <- ethdat$data$quotes
price <- data.frame( as.Date(price$time_close) , price$quote$USD$high, price$quote$USD$low, price$quote$USD$close)
colnames(price) <- c("date","high","low","close")
tail(price) %>% kbl() %>%  kable_paper("hover", full_width = F)

```

Now gather houly price data for the last 23 hours.

```{r,eth2}

URL=paste("https://web-api.coinmarketcap.com/v1/cryptocurrency/ohlcv/historical?symbol=ETH&convert=USD&interval=hourly&time_period=hourly&time_start=",Sys.Date(),"&time_end=",Sys.Date()+1,sep="")
download.file(URL,destfile="ethdat.txt")
ethdat <- fromJSON("ethdat.txt")
price2 <- ethdat$data$quotes
price2 <- data.frame( as.Date(price2$time_close)  , price2$quote$USD$high, price2$quote$USD$low, price2$quote$USD$close,stringsAsFactors=FALSE)
colnames(price2) <- c("date","high","low","close")
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

high <- max(price2[,2])
low <- min(price2[,3])
close <- price2[nrow(price2),4]

df <- data.frame(date=Sys.Date(),high=high,low=low,close=close,stringsAsFactors=FALSE)
price <- rbind(price,df)
tail(price) %>% kbl() %>%  kable_paper("hover", full_width = F)

if ( TESTING == TRUE) {
  price[nrow(price),"Close"] <- price[nrow(price),"Close"] * 2
}

```

## ETH SMA indicator

Now to determine whether ETH has crossed the 34-day SMA.

```{r, eth_sma}

price2 <- price

price2$ma <- SMA(Cl(price2),n=34)
price2$signal <- price2$close > price2$ma
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)
today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    eth_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    eth_signal="SELL"
  }
} else {
  eth_signal <- "NONE"
}

message(paste("ETH SMA signal:",eth_signal))

```

```{r, eth_sma_plot,fig.height=8,fig.width=8}

plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="ETH w 34D MA")
grid()
lines(price2$ma~ as.Date(price2$date) ,col="red")

```

Send a push notification.

```{r,eth_sma_push}

if ( eth_signal != "NONE") {
  MYNOTE <- paste("The ETH 34D MA signal is", eth_signal,
   ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## ETH SMA cross indicator

The 5/27 day SMA cross is a highly profitable strategy.

```{r, eth_cross}

price2 <- price

price2$ma1 <- SMA(Cl(price2),n=27)
price2$ma2 <- SMA(Cl(price2),n=5)

price2$signal <- price2$ma2 > price2$ma1
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)
today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    eth_signal="BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    eth_signal="SELL"
  }
} else {
eth_signal <- "NONE"
}

message(paste("ETH SMA cross signal:",eth_signal))

```

```{r, eth_cross_plot,fig.height=8,fig.width=8}

plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="ETH w 5/27 day SMA cross")
grid()
lines(price2$ma1~ as.Date(price2$date) ,col="red")
lines(price2$ma2~ as.Date(price2$date) ,col="blue")

```

Send a push notification.

```{r,eth_cross_push}

if ( eth_signal != "NONE") {
  MYNOTE <- paste("The ETH 5/27 day SMA cross signal is", eth_signal,
    ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## ETH DMI

For ETH, the 19 day interval DMI gave a good return.

```{r,eth_dmi,fig.height=10,fig.width=8}

dmi.adx <- ADX(price[,c("high","low","close")],n=19)
price2 <- cbind(price,dmi.adx)
price2$signal <- dmi.adx[,1] > dmi.adx[,2]
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    eth_signal="DMI BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    eth_signal="DMI SELL"
  }
} else {
  eth_signal <- "NONE"
}

message(paste("ETH DMI signal:",eth_signal))

```

```{r, eth_dmi_plot,fig.height=10,fig.width=8}

par(mfrow=c(2,1))
plot(price2$close~as.Date(price2$date),type="l",
  xlab="Date",ylab="price (USD)",main="ETH USD price")
grid()
plot(price2$DIp~as.Date(price2$date),type="l", col="blue",
  xlab="Date",ylab="price (USD)",main="ETH 19d DMI")
grid()
lines(price2$DIn ~ as.Date(price2$date) ,col="red")

```

Send a push notification.

```{r,eth_dmi_push}

if ( eth_signal != "NONE") {
  MYNOTE <- paste("ETH is flashing a ", eth_signal,
   ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## ETH TSI indicator

Optimised values:

n1=99, n2=3, n.sig=13

```{r,eth_tsi,fig.height=10,fig.width=8}

tsi <- TSI(price$close , n.first = 99, n.second = 3, n.signal = 13 )
colnames(tsi) <- c("tsi","sig")

price2 <- cbind(price,tsi)
price2$signal <- tsi[,1] > tsi[,2]
tail(price2) %>% kbl() %>%  kable_paper("hover", full_width = F)

today_signal <- price2[nrow(price2),"signal"]
previous_signal <- price2[(nrow(price2)-1),"signal"]
if (today_signal != previous_signal ) {
  if ( (today_signal == TRUE ) & (previous_signal == FALSE ) ) {
    eth_signal="TSI BUY"
  }
  if ( (today_signal == FALSE ) & (previous_signal == TRUE ) ) {
    eth_signal="TSI SELL"
  }
} else {
  eth_signal <- "NONE"
}

message(paste("ETH TSI signal:",eth_signal))

```

```{r,eth_tsi_plot,fig.height=10,fig.width=8}

par(mfrow=c(2,1))
plot(price2$close ~ as.Date(price2$date),type="l",log="y",
  xlab="Date",ylab="price (USD)",main="USD price")
grid()

plot(tsi[,1] ~ as.Date(price2$date),type="l",col="blue",
  xlab="Date",ylab="TSI",main="TSI")
lines(as.Date(price2$date), tsi[,2]  , col="red"  )
grid()

par(mfrow=c(1,1))

```

Send a push notification.

```{r,eth_tsi_push}

if ( eth_signal != "NONE") {
  MYNOTE <- paste("ETH is flashing a ", eth_signal,
   ". Visit https://mdz-analytics.com/crypto/alerts.html for the details")
  pbPost("note", "Crypto Alert", MYNOTE)
}

```

## Session information

For reproducibility

```{r,sessioninfo}

sessionInfo()

```
